<!DOCTYPE html>
<html>
    <head>
        <title>Hércules : Bases de datos</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Hércules</a></span>
                            </li>
                                                    <li>
                                <span><a href="597853529.html">Hércules</a></span>
                            </li>
                                                    <li>
                                <span><a href="597852519.html">SGI. Sistema de gestión de investigación</a></span>
                            </li>
                                                    <li>
                                <span><a href="597853279.html">Diseño</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Hércules : Bases de datos
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Usuario genérico para HERCULES</span>, last modified by <span class='editor'> Reyes Hernández-Mora Martínez</span> on dic 01, 2023
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>Antes de describir las diferentes bases de datos del SGI es importante ponerse en contexto dentro de la arquitectura de la aplicación, para ello, se incluye como referencia el siguiente diagrama, que representa tanto un modelo de despliegue como de comunicaciones a alto nivel entre cada una de las piezas que componen el SGI, así como las comunicaciones con otros sistemas externos.</p><h2 id="Basesdedatos-ArquitecturadelSGI"><span><strong>Arquitectura del SGI</strong></span></h2><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="400" src="attachments/676986997/676986998.png" data-image-src="attachments/676986997/676986998.png" data-unresolved-comment-count="0" data-linked-resource-id="676986998" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="SGI Deployment Model.png" data-base-url="https://confluence.um.es/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="676986997" data-linked-resource-container-version="89" alt=""></span></p><p><br/> </p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 95.9519%;"><colgroup><col style="width: 12.7211%;"/><col style="width: 14.5465%;"/><col style="width: 32.1164%;"/><col style="width: 8.84199%;"/><col style="width: 31.7741%;"/></colgroup><tbody><tr><th colspan="2" class="confluenceTh">Elemento</th><th colspan="1" class="confluenceTh">Descripción</th><th class="confluenceTh">Nº Elementos</th><th colspan="1" class="confluenceTh">Lista</th></tr><tr><th rowspan="3" class="confluenceTh">Elementos que acceden al SGI</th><th class="highlight-#ffebe6 confluenceTh" colspan="1" data-highlight-colour="#ffebe6">Dispositivo Sistema</th><td colspan="1" class="confluenceTd">Representa a cada uno de los sistemas que pueden comunicarse con el SGI iniciando un circuito de petición-respuesta HTTP a los servicios concretos expuestos en el SGI a través de su Bus de integración (ESB).</td><td colspan="1" class="confluenceTd">3</td><td colspan="1" class="confluenceTd"><p>ED MA, RPA, Goliat (UM)</p></td></tr><tr><th class="highlight-#ffebe6 confluenceTh" colspan="1" data-highlight-colour="#ffebe6">Dispositivo Usuario</th><td colspan="1" class="confluenceTd">Representa a cada uno de los sistemas que pueden comunicarse con la aplicación Web de Gestión del SGI iniciando un circuito de petición-respuesta HTTP.</td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">Dispositivo del usuario de la aplicación SGI , dispositivo del usuario de Goliat</td></tr><tr><th class="highlight-#ffebe6 confluenceTh" colspan="1" data-highlight-colour="#ffebe6">Conector BBDD</th><td colspan="1" class="confluenceTd">Representa una pieza que aglutina el acceso directo a la BBDD del SGI por parte de terceros (Universidad).</td><td colspan="1" class="confluenceTd">2</td><td colspan="1" class="confluenceTd">Conector BBDD (acceso a esquemas csp y pii)</td></tr><tr><th class="highlight-#fffae6 confluenceTh" data-highlight-colour="#fffae6" rowspan="6">KUBERNETES</th><th class="highlight-#ffebe6 confluenceTh" colspan="1" data-highlight-colour="#ffebe6">Gateway</th><td colspan="1" class="confluenceTd">Representa la pieza, que proporciona el propio Kubernetes, que se encarga de recibir las peticiones de los Dispositivos Usuario y Sistema y de redirigirlas en función del patrón que sigan al ESB, peticiones tipo <strong>/api/</strong>, o a la Web, resto de peticiones <strong>/*</strong>.</td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">Gateway</td></tr><tr><th class="highlight-#ffebe6 confluenceTh" colspan="1" data-highlight-colour="#ffebe6">WEB</th><td colspan="1" class="confluenceTd">Representa el módulo de la aplicación de gestión del SGI, que hará de orquestador de todas las peticiones que vayan dirigidas a él, llamando a los diferentes módulos según la necesidad de cada funcionalidad concreta.</td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">WEB</td></tr><tr><th class="highlight-#b3f5ff confluenceTh" colspan="1" data-highlight-colour="#b3f5ff">ESB</th><td colspan="1" class="confluenceTd"><p>Representa el Bus de integración del SGI, que abstrae tanto al SGI como los Elementos que acceden al SGI del origen de la información que se intercambia a través de él. Será esta pieza la que haga de pasarela, con o sin alguna adaptación según la necesidad, entre el SGI o los Dispositivos Sistema y Usuario y los servicios tanto internos al SGI como implementados por parte de terceros (Universidad).</p></td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd"><p>Habrá un único ESB que contendrá los siguientes Componentes:</p><ul><li>Los que requieren implementación por parte de terceros (Universidad): SGE, SGP, SGEMP, SGEPII.</li><li>Los que pueden tener o no implementación por parte de terceros (Universidad): SGO, SGDOC.</li><li>Los que dan acceso a servicios internos al SGI: SGICSP, SGIPII, SGIPRC, SGIUSR</li></ul></td></tr><tr><th class="highlight-#f4f5f7 confluenceTh" colspan="1" data-highlight-colour="#f4f5f7">ESB - Implementación SGI</th><td colspan="1" class="confluenceTd">Representa a los servicios del ESB que tienen implementación propia por parte del SGI de forma que se pueda utilizar si no se implementan por parte de terceros (Universidad).</td><td colspan="1" class="confluenceTd">2</td><td colspan="1" class="confluenceTd">SGISGO, SGISGDOC</td></tr><tr><th class="highlight-#f4f5f7 confluenceTh" colspan="1" data-highlight-colour="#f4f5f7">Módulos comunes</th><td colspan="1" class="confluenceTd">Representa a cada uno de los módulos de uso común por parte del resto de módulos o componentes de la aplicación.</td><td colspan="1" class="confluenceTd">7</td><td colspan="1" class="confluenceTd">USR, CNF, REL, REP, TP, COM, KEYCLOAK</td></tr><tr><th class="highlight-#f4f5f7 confluenceTh" colspan="1" data-highlight-colour="#f4f5f7">Módulos funcionales</th><td colspan="1" class="confluenceTd">Representa a cada uno de los módulos o componentes con funcionalidad concreta de gestión por parte de los usuarios o sistemas de terceros del SGI.</td><td colspan="1" class="confluenceTd">4</td><td colspan="1" class="confluenceTd">CSP, ETI, PII, PRC</td></tr><tr><th class="highlight-#eae6ff confluenceTh" data-highlight-colour="#eae6ff" rowspan="2">Persistencia</th><th class="highlight-#ffbdad confluenceTh" data-highlight-colour="#ffbdad">BBDD</th><td colspan="1" class="confluenceTd">Representa a cada uno de los esquemas de base de datos del SGI. Existirá un esquema por módulo.</td><td class="confluenceTd">13</td><td colspan="1" class="confluenceTd">csp, eti, pii, prc, ...</td></tr><tr><th class="highlight-#eae6ff confluenceTh" colspan="1" data-highlight-colour="#eae6ff">Almacenamiento archivos</th><td colspan="1" class="confluenceTd">Representa el componente encargado de persistir los documentos del SGI a disco.</td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">Almacenamiento archivos</td></tr><tr><th rowspan="4" class="confluenceTh">Sistemas Universidad</th><th class="highlight-#e3fcef confluenceTh" colspan="1" data-highlight-colour="#e3fcef">Servicios de integración</th><td colspan="1" class="confluenceTd">Representa a los servicios que pueden o deben, según el caso, ser implementados por terceros (Universidad) para la implantación del SGI en sus sistemas.</td><td colspan="1" class="confluenceTd">5</td><td colspan="1" class="confluenceTd">SGE (UNI), SGP (UNI), SGEMP (UNI), SGEPII (UNI), SGO (UNI) (Opcional)</td></tr><tr><th class="highlight-#ffebe6 confluenceTh" data-highlight-colour="#ffebe6">Goliat (UM)</th><td class="confluenceTd">Representa al sistema Goliat existente en la implementación propia del SGI de la Universidad de Murcia y que implementará las funcionalidades de Timesheet y de la que complementa al SGI en cuanto a la vista de los datos proyectos por parte del investigador.</td><td class="confluenceTd">2</td><td class="confluenceTd">Timesheet, Vista investigador</td></tr><tr><th class="highlight-#deebff confluenceTh" colspan="1" data-highlight-colour="#deebff">Servidor email</th><td colspan="1" class="confluenceTd">Representa la pieza que se encargará del envío de emails de Comunicados desde el sistema de terceros (Universidad) en el que se implante.</td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">Servidor email</td></tr><tr><th class="highlight-#deebff confluenceTh" colspan="1" data-highlight-colour="#deebff">CAS</th><td colspan="1" class="confluenceTd">Representa la pieza encargada de autenticar a los usuarios en el sistema de terceros (Universidad).</td><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">CAS</td></tr></tbody></table></div><h3 id="Basesdedatos-Componentes/Serviciosadesplegar">Componentes / Servicios a desplegar</h3><p>Los siguientes servicios  han de estar desplegados para el correcto funcionamiento del SGI:</p><img class="wysiwyg-unknown-macro" src="plugins/servlet/confluence/placeholder/unknown-macro"/><h3 id="Basesdedatos-Esquemasdebasededatos">Esquemas de base de datos</h3><h4 id="Basesdedatos-ESB-ImplementaciónSGI">ESB - Implementación SGI</h4><p>Nº de esquemas: 2</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 67.7243%;"><colgroup><col style="width: 8.58663%;"/><col style="width: 59.4045%;"/><col style="width: 6.5481%;"/><col style="width: 25.4608%;"/></colgroup><tbody><tr><th class="confluenceTh">Componente</th><th class="confluenceTh">Descripción</th><th colspan="1" class="confluenceTh">Esquema</th><th colspan="1" class="confluenceTh">Documentación</th></tr><tr><td colspan="1" class="confluenceTd">SGISGDOC</td><td colspan="1" class="confluenceTd">Módulo del sistema de gestión de la documentación <span>cross al resto de módulos del SGI.</span></td><td colspan="1" class="confluenceTd">sgdoc</td><td colspan="1" class="confluenceTd"><a href="https://confluence.um.es/confluence/display/HERCULES/SGI+-+ESB+-+SGDOC" rel="nofollow">SGI - ESB - SGDOC</a></td></tr><tr><td class="confluenceTd">SGISGO</td><td class="confluenceTd">Módulo del sistema de gestión de la organización <span>cross al resto de módulos del SGI.</span></td><td class="confluenceTd">sgo</td><td class="confluenceTd"><a href="https://confluence.um.es/confluence/display/HERCULES/SGI+-+ESB+-+SGO" rel="nofollow">SGI - ESB - SGO</a></td></tr></tbody></table></div><h4 id="Basesdedatos-Módulosfuncionales">Módulos funcionales</h4><p>Nº de esquemas: 4</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Componente</th><th class="confluenceTh">Descripción</th><th colspan="1" class="confluenceTh">Esquema</th><th colspan="1" class="confluenceTh">Documentación</th></tr><tr><td class="confluenceTd">CSP</td><td class="confluenceTd"><span>Módulo de convocatorias, ayudas, solicitudes, proyectos y contratos. Incluye además los grupos de investigación.<br/></span></td><td colspan="1" class="confluenceTd">csp</td><td colspan="1" class="confluenceTd"><p>Convocatorias:</p><ul><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852500" rel="nofollow">CSP-CON - Modelo lógico - Diagrama</a></li><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852699" rel="nofollow">CSP-CON - Modelo lógico - Documentación</a></li></ul><p>Solicitudes:</p><ul><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597853635" rel="nofollow">CSP-SOL - Modelo lógico - Diagrama</a></li><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852694" rel="nofollow">CSP-SOL - Módelo lógico - Documentación</a></li></ul><p>Proyectos:</p><ul><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597853327" rel="nofollow">CSP-PRO - Modelo lógico - Diagrama</a></li><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852754" rel="nofollow">CSP-PRO - Modelo lógico - Documentación</a></li></ul><p>Proyectos externos:</p><ul><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597853659" rel="nofollow">CSP-PPEX - Modelo lógico - Diagrama</a></li><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852745" rel="nofollow">CSP-PPEX - Modelo lógico - Documentación</a></li></ul><p>Grupos de investigación:</p><ul><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852812" rel="nofollow">CSP-GIN - Diseño lógico - Diagrama</a></li><li><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852701" rel="nofollow">CSP-GIN - Modelo lógico - Documentación</a></li></ul></td></tr><tr><td class="confluenceTd"><span>ETI</span></td><td class="confluenceTd">Módulo de Ética.</td><td class="confluenceTd">eti</td><td class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852355" rel="nofollow">ETI - Modelo lógico</a></td></tr><tr><td class="confluenceTd">PII</td><td class="confluenceTd">Módulo de Propiedad industrial e intelectual.</td><td class="confluenceTd">pii</td><td class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852351" rel="nofollow">PII - Modelo lógico</a></td></tr><tr><td class="confluenceTd"><span style="color: rgb(66,82,110);">PRC</span></td><td class="confluenceTd"><span style="color: rgb(66,82,110);">Módulo de producción científica.</span></td><td colspan="1" class="confluenceTd">prc</td><td colspan="1" class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597853216" rel="nofollow">PRC - Diseño lógico</a></td></tr></tbody></table></div><h4 id="Basesdedatos-Móduloscross">Módulos cross</h4><p>Nº de esquemas: 7</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 67.6696%;"><colgroup><col style="width: 8.59358%;"/><col style="width: 59.048%;"/><col style="width: 7.20065%;"/><col style="width: 25.1578%;"/></colgroup><tbody><tr><th class="confluenceTh">Componente</th><th class="confluenceTh">Descripción</th><th colspan="1" class="confluenceTh">Esquema</th><th colspan="1" class="confluenceTh">Documentación</th></tr><tr><td class="confluenceTd">CNF</td><td class="confluenceTd"><span>Módulo de configuración cross al resto de módulos del SGI.<br/></span></td><td colspan="1" class="confluenceTd">cnf</td><td colspan="1" class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852251" rel="nofollow">CNF - Modelo lógico</a></td></tr><tr><td class="confluenceTd">COM</td><td class="confluenceTd"><span>Módulo de comunicados cross al resto de módulos del SGI.<br/></span></td><td class="confluenceTd">com</td><td colspan="1" class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852855" rel="nofollow">COM - Modelo lógico</a></td></tr><tr><td class="confluenceTd">KEYCLOAK</td><td class="confluenceTd"><span>Módulo de control de acceso al SGI.<br/></span></td><td class="confluenceTd">keycloak</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">REL</td><td colspan="1" class="confluenceTd"><span>Módulo de relaciones cross al resto de módulos del SGI.</span></td><td colspan="1" class="confluenceTd">rel</td><td colspan="1" class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852752" rel="nofollow">SGI-REL - Modelo lógico</a></td></tr><tr><td class="confluenceTd">REP</td><td class="confluenceTd">Módulo de reporting <span>cross al resto de módulos del SGI.</span></td><td class="confluenceTd">rep</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">USR</td><td colspan="1" class="confluenceTd">Módulo para la autenticación de usuarios</td><td colspan="1" class="confluenceTd">usr</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">TP</td><td class="confluenceTd">Módulo del sistema de gestión de tareas programadas <span>cross al resto de módulos del SGI.</span></td><td class="confluenceTd">tp</td><td colspan="1" class="confluenceTd"><a href="https://confluence.um.es/confluence/pages/viewpage.action?pageId=597852469" rel="nofollow">TP - Modelo lógico</a></td></tr></tbody></table></div><h2 class="auto-cursor-target" id="Basesdedatos-TECNOLOGÍA"><strong>TECNOLOGÍA</strong></h2><p style="text-align: left;"><span style="color: rgb(0,0,0);">Los servicios del SGI se apoyan en Liquibase para la creación y mantenimiento del modelo de datos. Liquibase es un framework que permite tanto la definición del modelo de datos como la carga inicial de datos. Para ello utiliza su propia sintaxis (escrita en formato XML). A partir de esta sintaxis, este framework es capaz de hacer la traducción a sentencias propias del motor de base de datos que exista en la instalación, tanto para la creación inicial como para aplicar los cambios incrementales (de acuerdo al estado de la BD sobre la que se despliega la versión correspondiente).</span></p><p style="text-align: left;"><span style="color: rgb(0,0,0);">Por tanto, la definición y creación del modelo inicial, así como los incrementales propios de cada versión, se encuentran dentro del código de cada servicio. Cada vez que un servicio arranca, y conecta a la BBDD, se comprueba que cambios (changeset) se han aplicado, ejecutando aquellos que sean necesarios para que el modelo de datos esté actualizado de acuerdo a lo que espera la versión de la aplicación. De este modo, en las actualizaciones de la aplicación cada servicio aplica el incremental o incrementales correspondientes. En una instalación nueva (cuando no existen tablas porque es una nueva BBDD) se aplican todos los cambios necesarios para crear las tablas y objectos que necesita la aplicación para funcionar.</span></p><p style="text-align: left;"><span style="color: rgb(0,0,0);">En el siguiente enlace se puede ver un fichero de definición de Liquibase del servicio de CSP: </span><span style="color: blue;"><u><a class="external-link" href="https://urldefense.com/v3/__https://github.com/HerculesCRUE/SGI/blob/main/sgi-csp-service/src/main/resources/db/changelog/changes/0.1.0/0000000000000-initial-database.xml__;!!D9dNQwwGXtA!T99OejjEbLl9N78jYY9ZwU_wGFoPrHi73q3H3k1RWsafINRWEjC8DAp1Bjug7Lv9DJsbaEp6aj6R2_MDBATMwo2k$" rel="nofollow">https://github.com/HerculesCRUE/SGI/blob/main/sgi-csp-service/src/main/resources/db/changelog/changes/0.1.0/0000000000000-initial-database.xml</a></u></span></p><p style="text-align: left;"><span style="color: rgb(0,0,0);">Si lo ves necesario, para mayor detalle, puedes hacer referencia a la documentación oficial de Liquibase </span><span style="color: blue;"><u><a class="external-link" href="https://urldefense.com/v3/__https://docs.liquibase.com/home.html__;!!D9dNQwwGXtA!T99OejjEbLl9N78jYY9ZwU_wGFoPrHi73q3H3k1RWsafINRWEjC8DAp1Bjug7Lv9DJsbaEp6aj6R2_MDBD16gtXY$" rel="nofollow">https://docs.liquibase.com/home.html</a></u></span></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/676986997/676986998.png">SGI Deployment Model.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on oct 09, 2024 11:38</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
